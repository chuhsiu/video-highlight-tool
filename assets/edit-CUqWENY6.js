import{d as L,j as q,h as x,o as y,g as u,F as A,k as X,n as D,t as H,_ as G,l as re,r as V,m as ae,s as J,w as O,p as ce,e as r,q as S,f as ue,i as K,V as M,v as ne,x as de,y as W,z as fe,u as se,A as ve,B as me,c as ie,b as k,C as ge,D as pe,E as _e,G as he,H as Y,I as ye,J as ke,K as xe,L as be,M as Ce,N as Ie,O as Ve,P as Te,Q as Se,R as He,S as Pe,T as we,U as $e,W as Be,X as Ee,Y as De,Z as Le,$ as Re,a0 as Me,a1 as Ae,a2 as Fe,a3 as Ne,a4 as ze,a5 as Z,a6 as Ue,a7 as je,a8 as Xe}from"./index-D5vi4wCT.js";import{b as E,u as Oe,c as oe,a as F,V as le}from"./VSkeletonLoader-BlFA1H1E.js";const We={class:"timeline bar"},qe={class:"timeline-info"},Ge=L({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:t}){const i=e,n=t,d=q(()=>i.duration?i.currentTime/i.duration*100:0);function l(a){const p=Math.floor(a/60),v=Math.floor(a%60);return`${String(p).padStart(2,"0")}:${String(v).padStart(2,"0")}`}function c(a){return i.duration?a/i.duration*100:0}function _(a){if(!i.duration)return 0;const p=i.clipDuration/i.duration*100,v=a!==void 0?c(a):0;return Math.min(p,100-v)}function f(a){const v=a.currentTarget.getBoundingClientRect(),g=(a.clientX-v.left)/v.width,h=i.duration*g;n("seek",h)}return(a,p)=>(y(),x("div",{class:"timeline-wrapper",onClick:p[0]||(p[0]=v=>f(v))},[u("div",We,[(y(!0),x(A,null,X(a.highlights,v=>(y(),x("div",{key:v.id,class:"timeline marker bg-primary",style:D({left:c(v.time)+"%",width:_(v.time)+"%"})},null,4))),128))]),u("div",{class:"timeline indicator bg-error",style:D({left:d.value+"%"})},null,4),u("div",qe,[u("span",null,H(l(a.currentTime)),1),u("span",null,H(l(a.duration)),1)])]))}}),Je=G(Ge,[["__scopeId","data-v-10da3b86"]]),Q=re("player",()=>{const e=V(null);function t(c){e.value=c}const i=ae([]);function n(c){i.some(f=>f.id===c.id)||(i.push(c),i.sort((f,a)=>f.time-a.time))}function d(c){const _=i.findIndex(f=>f.id===c);_>=0&&i.splice(_,1)}function l(){i.splice(0,i.length)}return{currentId:e,setCurrentId:t,selectedHighlights:i,resetHighlights:l,addHighlight:n,removeHighlight:d}});function Ke(e,t){return t?e.find(i=>i.id===t)??null:null}function ee(e,t,i){return e.find(n=>t>=n.time&&t<n.time+i)??null}function B(e,t){return e.findIndex(i=>i.id===t)}function te(e,t){return(e+1)%t}function Qe(e,t){return e<=0?t-1:e-1}function Ye(e,t,i){return e>=t+i}function Ze(e,t){return e>=t}function T(e){return e.value}function U(e,t){e&&(e.currentTime=t)}function et(e,t){e&&(e.play(),t.value=!0)}function tt(e,t){e&&(e.pause(),t.value=!1)}const nt={class:"border pa-4 bg-surface"},st={key:1,class:"position-relative"},it=["src"],ot={key:0,class:"position-absolute left-0 text-caption font-weight-400",style:{translate:"(-50%, 0%)",bottom:"3px"}},lt={class:"d-flex justify-space-evenly"},j=5,rt=L({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const t=Q(),{currentId:i}=J(t),n=V(null),d=V(0),l=V(null),c=V(!1),_=V(0);function f(){et(T(n),c)}function a(){tt(T(n),c)}function p(){const o=T(n);o&&(o.paused?f():a())}function v(o){const s=t.selectedHighlights.findIndex(m=>m.id===o);s!==-1&&(_.value=s,U(T(n),t.selectedHighlights[s].time))}function C(){const{selectedHighlights:o}=t;if(!o.length||t.currentId==null)return;const s=B(o,t.currentId),m=Qe(s,o.length);t.setCurrentId(o[m].id)}function g(){const{selectedHighlights:o}=t;if(!o.length||t.currentId==null)return;const s=B(o,t.currentId),m=te(s,o.length);t.setCurrentId(o[m].id)}function h(){const o=T(n);if(!o)return;d.value=o.currentTime;const s=ee(t.selectedHighlights,d.value,j);s?(l.value=s,t.currentId!==s.id&&t.setCurrentId(s.id)):l.value=null;const m=Ke(t.selectedHighlights,t.currentId);if(!m)return;const b=B(t.selectedHighlights,m.id)===t.selectedHighlights.length-1,P=Ye(d.value,m.time,j),N=Ze(d.value,o.duration);if(P||b&&N){const z=B(t.selectedHighlights,m.id),R=te(z,t.selectedHighlights.length),w=t.selectedHighlights[R];t.setCurrentId(w.id),U(o,w.time),f()}}O(d,o=>{const s=ee(t.selectedHighlights,o,j);l.value=s,_.value=s?B(t.selectedHighlights,s.id):0}),O(()=>t.currentId,o=>{o!=null&&v(o)}),ce(()=>{const o=t.selectedHighlights,s=T(n);s&&(o.length?(o.length===1||!o.some(m=>m.id===t.currentId))&&(t.setCurrentId(o[0].id),s.paused&&f()):(d.value=0,a(),t.setCurrentId(0)))});function I(o){U(T(n),o)}return(o,s)=>{var b;const m=Je;return y(),x("div",nt,[s[2]||(s[2]=u("h3",null,"Preview",-1)),S(t).selectedHighlights.length===0?(y(),x(A,{key:0},[s[0]||(s[0]=u("p",{class:"text-grey-darken-3"},"Please select a highlight!",-1)),r(E,{boilerplate:"",type:"image",class:"mt-4 mb-8"})],64)):(y(),x("div",st,[u("video",{ref_key:"videoRef",ref:n,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:h},s[1]||(s[1]=[u("source",{type:"video/*"},null,-1),K(" The browser doesn't support HTML5 video. ")]),40,it),l.value?(y(),x("div",ot,H(l.value.text),1)):ue("",!0)])),r(m,{currentTime:d.value,duration:((b=n.value)==null?void 0:b.duration)||0,highlights:S(t).selectedHighlights,clipDuration:5,onSeek:I},null,8,["currentTime","duration","highlights"]),u("div",lt,[r(M,{icon:"mdi-chevron-double-left",onClick:C,variant:"text"}),r(M,{icon:c.value?"mdi-pause":"mdi-play",onClick:p,variant:"text"},null,8,["icon"]),r(M,{icon:"mdi-chevron-double-right",onClick:g,variant:"text"})])])}}}),at=G(rt,[["__scopeId","data-v-1f4e5a8c"]]),ct={class:"py-2"},ut=["onClick"],dt=L({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const{xs:t,sm:i}=ne(),n=q(()=>t.value||i.value),d=Q(),{currentId:l,selectedHighlights:c}=J(d);function _(g){c.value.some(I=>I.id===g.id)?d.removeHighlight(g.id):d.addHighlight(g)}function f(g){return c.value.some(h=>h.id===g.id)}const a=V(null),p=new Map;function v(g,h){h instanceof HTMLElement&&p.set(g,h)}function C(){de(()=>{const g=p.get(l.value);g&&g.scrollIntoView({behavior:"smooth",block:"center"})})}return O(l,()=>{l.value!=null&&C()}),(g,h)=>(y(),x("div",{ref_key:"containerRef",ref:a,class:"border pa-4 bg-surface overflow-y-auto",style:D({maxHeight:n.value?"25vh":"80vh"})},[h[0]||(h[0]=u("h3",null,"Transcript",-1)),(y(!0),x(A,null,X(e.sections,(I,o)=>(y(),x("div",{key:o},[u("h4",ct,H(I.title),1),u("ul",null,[(y(!0),x(A,null,X(I.highlights,(s,m)=>(y(),x("li",{key:m,ref_for:!0,ref:b=>v(s.id,b),onClick:b=>_(s),class:W([{"bg-blue-darken-3":s.id===S(l),"text-grey-lighten-2":f(s)&&s.id===S(l),"text-blue-lighten-1":f(s)&&s.id!==S(l),"border-primary":f(s),"bg-grey-darken-2":s.id!==S(l)},"border-md rounded-lg ma-2 pa-2"])},[u("strong",null,H(s.time)+"s",1),K(" - "+H(s.text),1)],10,ut))),128))]),r(fe)]))),128))],4))}}),ft=G(dt,[["__scopeId","data-v-690f554f"]]);async function vt(e){const t=await fetch(`/getSections?duration=${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}const mt=L({__name:"EditorLoader",setup(e){const{xs:t,sm:i}=ne(),n=q(()=>t.value||i.value),d=se(),l=Q(),c=Oe(),{videoUrl:_}=J(c),f=V([]);return ve(async()=>{if(c.videoDuration===0){c.resetVideo(),d.push("/");return}try{f.value=await vt(c.videoDuration)}catch(a){console.error("Failed to fetchSections:",a)}}),me(()=>{c.resetVideo(),l.resetHighlights(),l.setCurrentId(0)}),(a,p)=>{const v=ft,C=at;return y(),ie(oe,null,{default:k(()=>[r(le,null,{default:k(()=>[r(F,{cols:"12",md:"6",order:n.value?2:1},{default:k(()=>[r(v,{sections:f.value},null,8,["sections"])]),_:1},8,["order"]),r(F,{class:"mb-5 scroll-y-auto",cols:"12",md:"6",order:n.value?1:2},{default:k(()=>[r(C,{videoUrl:S(_)},null,8,["videoUrl"])]),_:1},8,["order"])]),_:1})]),_:1})}}}),gt=ge("v-alert-title"),pt=["success","info","warning","error"],_t=_e({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Fe,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>pt.includes(e)},...Ae(),...Me(),...Re(),...Le(),...De(),...Ee(),...Be(),...$e(),...we(),...Pe({variant:"flat"})},"VAlert"),ht=pe()({name:"VAlert",props:_t(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:i,slots:n}=t;const d=he(e,"modelValue"),l=Y(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:c}=ye(e),{colorClasses:_,colorStyles:f,variantClasses:a}=ke(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:p}=xe(e),{dimensionStyles:v}=be(e),{elevationClasses:C}=Ce(e),{locationStyles:g}=Ie(e),{positionClasses:h}=Ve(e),{roundedClasses:I}=Te(e),{textColorClasses:o,textColorStyles:s}=Se(()=>e.borderColor),{t:m}=He(),b=Y(()=>({"aria-label":m(e.closeLabel),onClick(P){d.value=!1,i("click:close",P)}}));return()=>{const P=!!(n.prepend||l.value),N=!!(n.title||e.title),z=!!(n.close||e.closable);return d.value&&r(e.tag,{class:W(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},c.value,_.value,p.value,C.value,h.value,I.value,a.value,e.class]),style:D([f.value,v.value,g.value,e.style]),role:"alert"},{default:()=>{var R,w;return[Ne(!1,"v-alert"),e.border&&u("div",{key:"border",class:W(["v-alert__border",o.value]),style:D(s.value)},null),P&&u("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?r(Z,{key:"prepend-defaults",disabled:!l.value,defaults:{VIcon:{density:e.density,icon:l.value,size:e.prominent?44:28}}},n.prepend):r(ze,{key:"prepend-icon",density:e.density,icon:l.value,size:e.prominent?44:28},null)]),u("div",{class:"v-alert__content"},[N&&r(gt,{key:"title"},{default:()=>{var $;return[(($=n.title)==null?void 0:$.call(n))??e.title]}}),((R=n.text)==null?void 0:R.call(n))??e.text,(w=n.default)==null?void 0:w.call(n)]),n.append&&u("div",{key:"append",class:"v-alert__append"},[n.append()]),z&&u("div",{key:"close",class:"v-alert__close"},[n.close?r(Z,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var $;return[($=n.close)==null?void 0:$.call(n,{props:b.value})]}}):r(M,Ue({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},b.value),null)])]}})}}}),yt={class:"border pa-4"},kt={class:"border pa-4"},Ct=L({__name:"edit",setup(e){const t=se();return je(i=>(console.error("Suspense caught error:",i),(i.message.includes("404")||i.message.includes("Failed to fetch"))&&t.replace("/"),!1)),(i,n)=>{const d=mt;return y(),ie(Xe,null,{default:k(()=>[r(d)]),fallback:k(()=>[r(oe,null,{default:k(()=>[r(le,null,{default:k(()=>[r(F,null,{default:k(()=>[u("div",yt,[n[0]||(n[0]=u("h3",null,"Transcript",-1)),r(E,{type:"list-item-three-line"}),r(E,{type:"list-item-three-line"}),r(E,{type:"list-item-three-line"})])]),_:1}),r(F,null,{default:k(()=>[u("div",kt,[n[1]||(n[1]=u("h3",null,"Preview",-1)),r(E,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:k(({error:l})=>[r(ht,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:k(()=>[K(" Failed to Load data："+H(l.message),1)]),_:2},1024)]),_:1})}}});export{Ct as default};
