import{d as M,j as ee,h as k,o as _,g as f,F as R,k as j,n as E,t as S,_ as z,l as te,r as V,m as ne,s as W,w as O,p as se,e as a,q as I,i as L,f as ie,V as D,v as le,x as X,y as oe,u as ae,z as re,A as ce,c as J,b as y,B as ue,C as de,D as fe,E as ve,G as q,H as me,I as ge,J as pe,K as he,L as _e,M as ye,N as ke,O as xe,P as be,Q as Ce,R as Te,S as He,T as Ve,U as Ie,W as Se,X as Pe,Y as we,Z as $e,$ as Be,a0 as De,a1 as Re,a2 as Ee,a3 as Le,a4 as G,a5 as Ae,a6 as Me}from"./index-Cxlw8XuJ.js";import{b as $,u as ze,c as K,a as A,V as Q}from"./VSkeletonLoader-DQgClJU2.js";const Ne={class:"timeline bar"},Ue={class:"timeline-info"},Fe=M({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:n}){const i=e,t=n,v=ee(()=>i.duration?i.currentTime/i.duration*100:0);function d(u){const r=Math.floor(u/60),o=Math.floor(u%60);return`${String(r).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function c(u){return i.duration?u/i.duration*100:0}function g(u){if(!i.duration)return 0;const r=i.clipDuration/i.duration*100,o=u!==void 0?c(u):0;return Math.min(r,100-o)}function p(u){const o=u.currentTarget.getBoundingClientRect(),C=(u.clientX-o.left)/o.width,s=i.duration*C;t("seek",s)}return(u,r)=>(_(),k("div",{class:"timeline-wrapper",onClick:r[0]||(r[0]=o=>p(o))},[f("div",Ne,[(_(!0),k(R,null,j(u.highlights,o=>(_(),k("div",{key:o.id,class:"timeline marker bg-primary",style:E({left:c(o.time)+"%",width:g(o.time)+"%"})},null,4))),128))]),f("div",{class:"timeline indicator bg-error",style:E({left:v.value+"%"})},null,4),f("div",Ue,[f("span",null,S(d(u.currentTime)),1),f("span",null,S(d(u.duration)),1)])]))}}),je=z(Fe,[["__scopeId","data-v-10da3b86"]]),Y=te("player",()=>{const e=V(null);function n(c){e.value=c}const i=ne([]);function t(c){i.some(p=>p.id===c.id)||(i.push(c),i.sort((p,u)=>p.time-u.time))}function v(c){const g=i.findIndex(p=>p.id===c);g>=0&&i.splice(g,1)}function d(c){i.splice(0,i.length,...c.sort((g,p)=>g.time-p.time))}return{currentId:e,setCurrentId:n,selectedHighlights:i,setHighlights:d,addHighlight:t,removeHighlight:v}}),Oe={class:"border pa-4 bg-surface",style:{height:"80vh"}},Xe={key:1,style:{position:"relative"}},We=["src"],qe={key:0,class:"position-absolute left-0 bottom-0 text-caption font-weight-400",style:{translate:"(-50%, 0%)"}},Ge={class:"d-flex justify-space-evenly"},F=5,Je=M({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const n=Y(),{currentId:i}=W(n),t=V(null),v=V(0),d=V(null),c=V(!1),g=V(0);function p(){t.value&&(t.value.paused?(t.value.play(),c.value=!0):(t.value.pause(),c.value=!1))}function u(s){const l=n.selectedHighlights.findIndex(h=>h.id===s);if(l===-1)return;const m=n.selectedHighlights[l];g.value=l,t.value&&(t.value.currentTime=m.time)}function r(){if(n.selectedHighlights.length===0||i.value==null)return;const s=n.selectedHighlights.findIndex(h=>h.id===i.value);if(s===-1)return;const l=s===0?n.selectedHighlights.length-1:s-1,m=n.selectedHighlights[l];n.setCurrentId(m.id)}function o(){if(n.selectedHighlights.length===0||i.value==null)return;const s=n.selectedHighlights.findIndex(h=>h.id===i.value);if(s===-1)return;const l=(s+1)%n.selectedHighlights.length,m=n.selectedHighlights[l];n.setCurrentId(m.id)}function x(){if(!t.value)return;const s=t.value;v.value=s.currentTime;const{selectedHighlights:l}=n,m=s.duration,h=v.value;if(!l.length)return;const P=l.find(b=>h>=b.time&&h<b.time+F);P?(d.value=P,i.value!==P.id&&n.setCurrentId(P.id)):d.value=null;const T=l.find(b=>b.id===i.value);if(!T)return;const w=l.findIndex(b=>b.id===T.id)===l.length-1,N=h>=T.time+F,U=h>=m;if(N||w&&U){if(l.length===1)s.currentTime=T.time,t.value.pause();else{const B=(l.findIndex(Z=>Z.id===T.id)+1)%l.length,H=l[B];n.setCurrentId(H.id),s.currentTime=H.time}c.value=!1}}O(v,s=>{const l=n.selectedHighlights.findIndex(m=>s>=m.time&&s<=m.time+F);l!==-1?(d.value=n.selectedHighlights[l],g.value=l):d.value=null}),O(i,s=>{u(s)}),se(()=>{const s=n.selectedHighlights;t.value&&(s.length===0?(v.value=0,t.value.pause(),c.value=!1,n.setCurrentId(0)):(s.length===1||!s.some(l=>l.id===i.value))&&(n.setCurrentId(s[0].id),t.value.paused&&(t.value.play(),c.value=!0)))});function C(s){t.value&&(t.value.currentTime=s)}return(s,l)=>{var h;const m=je;return _(),k("div",Oe,[l[2]||(l[2]=f("h3",null,"Preview",-1)),I(n).selectedHighlights.length===0?(_(),k(R,{key:0},[l[0]||(l[0]=L(" 尚未選擇片段 ")),a($,{boilerplate:"",type:"image",class:"ma-4"})],64)):(_(),k("div",Xe,[f("video",{ref_key:"videoRef",ref:t,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:x},l[1]||(l[1]=[f("source",{type:"video/*"},null,-1),L(" The browser doesn't support HTML5 video. ")]),40,We),d.value?(_(),k("div",qe,S(d.value.text),1)):ie("",!0)])),a(m,{currentTime:v.value,duration:((h=t.value)==null?void 0:h.duration)||0,highlights:I(n).selectedHighlights,clipDuration:5,onSeek:C},null,8,["currentTime","duration","highlights"]),f("div",Ge,[a(D,{icon:"mdi-chevron-double-left",onClick:r,variant:"text"}),a(D,{icon:c.value?"mdi-pause":"mdi-play",onClick:p,variant:"text"},null,8,["icon"]),a(D,{icon:"mdi-chevron-double-right",onClick:o,variant:"text"})])])}}}),Ke=z(Je,[["__scopeId","data-v-d2eaf4d7"]]),Qe={class:"py-2"},Ye=["onClick"],Ze=M({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const n=Y(),{currentId:i,selectedHighlights:t}=W(n);function v(r){t.value.some(x=>x.id===r.id)?n.removeHighlight(r.id):n.addHighlight(r)}function d(r){return t.value.some(o=>o.id===r.id)}const c=V(null),g=new Map;function p(r,o){o instanceof HTMLElement&&g.set(r,o)}function u(){le(()=>{const r=g.get(i.value),o=c.value;if(r&&o){const x=r.offsetTop,C=r.offsetHeight,s=o.clientHeight,l=x-s/2+C/2;o.scrollTo({top:l,behavior:"smooth"})}})}return O(i,()=>{i.value!=null&&u()}),(r,o)=>(_(),k("div",{class:"border pa-4 bg-surface editor-container",ref_key:"containerRef",ref:c},[o[0]||(o[0]=f("h3",null,"Transcript",-1)),(_(!0),k(R,null,j(e.sections,(x,C)=>(_(),k("div",{key:C},[f("h4",Qe,S(x.title),1),f("ul",null,[(_(!0),k(R,null,j(x.highlights,(s,l)=>(_(),k("li",{key:l,ref_for:!0,ref:m=>p(s.id,m),onClick:m=>v(s),class:X([{"bg-blue-darken-3":s.id===I(i),"text-grey-lighten-2":d(s)&&s.id===I(i),"text-blue-lighten-1":d(s)&&s.id!==I(i),"border-primary":d(s),"bg-grey-darken-2":s.id!==I(i)},"border-md rounded-lg ma-2 pa-2"])},[f("strong",null,S(s.time)+"s",1),L(" - "+S(s.text),1)],10,Ye))),128))]),a(oe)]))),128))],512))}}),et=z(Ze,[["__scopeId","data-v-1fa71dda"]]);async function tt(e){const n=await fetch(`/getSections?duration=${e}`);if(!n.ok)throw new Error("Network response was not ok");return await n.json()}const nt=M({__name:"EditorLoader",async setup(e){let n,i;const t=ae(),v=ze(),{videoUrl:d}=W(v);v.videoDuration==0&&(v.resetVideo(),t.push("/"));const c=V(([n,i]=re(()=>tt(v.videoDuration)),n=await n,i(),n));return ce(()=>{v.resetVideo()}),(g,p)=>{const u=et,r=Ke;return _(),J(K,null,{default:y(()=>[a(Q,null,{default:y(()=>[a(A,null,{default:y(()=>[a(u,{sections:c.value},null,8,["sections"])]),_:1}),a(A,null,{default:y(()=>[a(r,{videoUrl:I(d)},null,8,["videoUrl"])]),_:1})]),_:1})]),_:1})}}}),st=ue("v-alert-title"),it=["success","info","warning","error"],lt=fe({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Re,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>it.includes(e)},...De(),...Be(),...$e(),...we(),...Pe(),...Se(),...Ie(),...Ve(),...He(),...Te({variant:"flat"})},"VAlert"),ot=de()({name:"VAlert",props:lt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,n){let{emit:i,slots:t}=n;const v=ve(e,"modelValue"),d=q(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:c}=me(e),{colorClasses:g,colorStyles:p,variantClasses:u}=ge(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:r}=pe(e),{dimensionStyles:o}=he(e),{elevationClasses:x}=_e(e),{locationStyles:C}=ye(e),{positionClasses:s}=ke(e),{roundedClasses:l}=xe(e),{textColorClasses:m,textColorStyles:h}=be(()=>e.borderColor),{t:P}=Ce(),T=q(()=>({"aria-label":P(e.closeLabel),onClick(w){v.value=!1,i("click:close",w)}}));return()=>{const w=!!(t.prepend||d.value),N=!!(t.title||e.title),U=!!(t.close||e.closable);return v.value&&a(e.tag,{class:X(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},c.value,g.value,r.value,x.value,s.value,l.value,u.value,e.class]),style:E([p.value,o.value,C.value,e.style]),role:"alert"},{default:()=>{var b,B;return[Ee(!1,"v-alert"),e.border&&f("div",{key:"border",class:X(["v-alert__border",m.value]),style:E(h.value)},null),w&&f("div",{key:"prepend",class:"v-alert__prepend"},[t.prepend?a(G,{key:"prepend-defaults",disabled:!d.value,defaults:{VIcon:{density:e.density,icon:d.value,size:e.prominent?44:28}}},t.prepend):a(Le,{key:"prepend-icon",density:e.density,icon:d.value,size:e.prominent?44:28},null)]),f("div",{class:"v-alert__content"},[N&&a(st,{key:"title"},{default:()=>{var H;return[((H=t.title)==null?void 0:H.call(t))??e.title]}}),((b=t.text)==null?void 0:b.call(t))??e.text,(B=t.default)==null?void 0:B.call(t)]),t.append&&f("div",{key:"append",class:"v-alert__append"},[t.append()]),U&&f("div",{key:"close",class:"v-alert__close"},[t.close?a(G,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var H;return[(H=t.close)==null?void 0:H.call(t,{props:T.value})]}}):a(D,Ae({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},T.value),null)])]}})}}}),at={},rt={class:"border pa-4"},ct={class:"border pa-4"};function ut(e,n){const i=nt;return _(),J(Me,null,{default:y(()=>[a(i)]),fallback:y(()=>[a(K,null,{default:y(()=>[a(Q,null,{default:y(()=>[a(A,null,{default:y(()=>[f("div",rt,[n[0]||(n[0]=f("h3",null,"Transcript",-1)),a($,{type:"list-item-three-line"}),a($,{type:"list-item-three-line"}),a($,{type:"list-item-three-line"})])]),_:1}),a(A,null,{default:y(()=>[f("div",ct,[n[1]||(n[1]=f("h3",null,"Preview",-1)),a($,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:y(({error:t})=>[a(ot,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:y(()=>[L(" 發生錯誤："+S(t.message),1)]),_:2},1024)]),_:1})}const vt=z(at,[["render",ut]]);export{vt as default};
