import{d as N,j as G,h as x,o as y,g as u,F as M,k as O,n as E,t as P,_ as z,l as le,r as V,m as re,s as J,w as W,p as ae,e as l,q as H,f as ce,i as K,V as R,v as ne,x as ue,y as q,z as de,u as fe,A as ve,B as me,c as se,b as k,C as ge,D as pe,E as _e,G as he,H as Y,I as ye,J as ke,K as xe,L as be,M as Ce,N as Ie,O as Ve,P as Te,Q as He,R as Pe,S as Se,T as we,U as $e,W as Be,X as De,Y as Ee,Z as Le,$ as Re,a0 as Me,a1 as Ae,a2 as Ne,a3 as ze,a4 as Fe,a5 as Z,a6 as Ue,a7 as je}from"./index-CNV33SNh.js";import{b as D,u as Xe,c as ie,a as A,V as oe}from"./VSkeletonLoader-Dcq9nKm7.js";const Oe={class:"timeline bar"},We={class:"timeline-info"},qe=N({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:t}){const o=e,n=t,d=G(()=>o.duration?o.currentTime/o.duration*100:0);function r(a){const p=Math.floor(a/60),v=Math.floor(a%60);return`${String(p).padStart(2,"0")}:${String(v).padStart(2,"0")}`}function c(a){return o.duration?a/o.duration*100:0}function _(a){if(!o.duration)return 0;const p=o.clipDuration/o.duration*100,v=a!==void 0?c(a):0;return Math.min(p,100-v)}function f(a){const v=a.currentTarget.getBoundingClientRect(),g=(a.clientX-v.left)/v.width,h=o.duration*g;n("seek",h)}return(a,p)=>(y(),x("div",{class:"timeline-wrapper",onClick:p[0]||(p[0]=v=>f(v))},[u("div",Oe,[(y(!0),x(M,null,O(a.highlights,v=>(y(),x("div",{key:v.id,class:"timeline marker bg-primary",style:E({left:c(v.time)+"%",width:_(v.time)+"%"})},null,4))),128))]),u("div",{class:"timeline indicator bg-error",style:E({left:d.value+"%"})},null,4),u("div",We,[u("span",null,P(r(a.currentTime)),1),u("span",null,P(r(a.duration)),1)])]))}}),Ge=z(qe,[["__scopeId","data-v-10da3b86"]]),Q=le("player",()=>{const e=V(null);function t(c){e.value=c}const o=re([]);function n(c){o.some(f=>f.id===c.id)||(o.push(c),o.sort((f,a)=>f.time-a.time))}function d(c){const _=o.findIndex(f=>f.id===c);_>=0&&o.splice(_,1)}function r(){o.splice(0,o.length)}return{currentId:e,setCurrentId:t,selectedHighlights:o,resetHighlights:r,addHighlight:n,removeHighlight:d}});function Je(e,t){return t?e.find(o=>o.id===t)??null:null}function ee(e,t,o){return e.find(n=>t>=n.time&&t<n.time+o)??null}function B(e,t){return e.findIndex(o=>o.id===t)}function te(e,t){return(e+1)%t}function Ke(e,t){return e<=0?t-1:e-1}function Qe(e,t,o){return e>=t+o}function Ye(e,t){return e>=t}function T(e){return e.value}function j(e,t){e&&(e.currentTime=t)}function Ze(e,t){e&&(e.play(),t.value=!0)}function et(e,t){e&&(e.pause(),t.value=!1)}const tt={class:"border pa-4 bg-surface"},nt={key:1,class:"position-relative"},st=["src"],it={key:0,class:"position-absolute left-0 text-caption font-weight-400",style:{translate:"(-50%, 0%)",bottom:"3px"}},ot={class:"d-flex justify-space-evenly"},X=5,lt=N({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const t=Q(),{currentId:o}=J(t),n=V(null),d=V(0),r=V(null),c=V(!1),_=V(0);function f(){Ze(T(n),c)}function a(){et(T(n),c)}function p(){const i=T(n);i&&(i.paused?f():a())}function v(i){const s=t.selectedHighlights.findIndex(m=>m.id===i);s!==-1&&(_.value=s,j(T(n),t.selectedHighlights[s].time))}function C(){const{selectedHighlights:i}=t;if(!i.length||t.currentId==null)return;const s=B(i,t.currentId),m=Ke(s,i.length);t.setCurrentId(i[m].id)}function g(){const{selectedHighlights:i}=t;if(!i.length||t.currentId==null)return;const s=B(i,t.currentId),m=te(s,i.length);t.setCurrentId(i[m].id)}function h(){const i=T(n);if(!i)return;d.value=i.currentTime;const s=ee(t.selectedHighlights,d.value,X);s?(r.value=s,t.currentId!==s.id&&t.setCurrentId(s.id)):r.value=null;const m=Je(t.selectedHighlights,t.currentId);if(!m)return;const b=B(t.selectedHighlights,m.id)===t.selectedHighlights.length-1,S=Qe(d.value,m.time,X),F=Ye(d.value,i.duration);if(S||b&&F){const U=B(t.selectedHighlights,m.id),L=te(U,t.selectedHighlights.length),w=t.selectedHighlights[L];t.setCurrentId(w.id),j(i,w.time),f()}}W(d,i=>{const s=ee(t.selectedHighlights,i,X);r.value=s,_.value=s?B(t.selectedHighlights,s.id):0}),W(()=>t.currentId,i=>{i!=null&&v(i)}),ae(()=>{const i=t.selectedHighlights,s=T(n);s&&(i.length?(i.length===1||!i.some(m=>m.id===t.currentId))&&(t.setCurrentId(i[0].id),s.paused&&f()):(d.value=0,a(),t.setCurrentId(0)))});function I(i){j(T(n),i)}return(i,s)=>{var b;const m=Ge;return y(),x("div",tt,[s[2]||(s[2]=u("h3",null,"Preview",-1)),H(t).selectedHighlights.length===0?(y(),x(M,{key:0},[s[0]||(s[0]=u("p",{class:"text-grey-darken-3"},"Please select a highlight!",-1)),l(D,{boilerplate:"",type:"image",class:"mt-4 mb-8"})],64)):(y(),x("div",nt,[u("video",{ref_key:"videoRef",ref:n,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:h},s[1]||(s[1]=[u("source",{type:"video/*"},null,-1),K(" The browser doesn't support HTML5 video. ")]),40,st),r.value?(y(),x("div",it,P(r.value.text),1)):ce("",!0)])),l(m,{currentTime:d.value,duration:((b=n.value)==null?void 0:b.duration)||0,highlights:H(t).selectedHighlights,clipDuration:5,onSeek:I},null,8,["currentTime","duration","highlights"]),u("div",ot,[l(R,{icon:"mdi-chevron-double-left",onClick:C,variant:"text"}),l(R,{icon:c.value?"mdi-pause":"mdi-play",onClick:p,variant:"text"},null,8,["icon"]),l(R,{icon:"mdi-chevron-double-right",onClick:g,variant:"text"})])])}}}),rt=z(lt,[["__scopeId","data-v-1f4e5a8c"]]),at={class:"py-2"},ct=["onClick"],ut=N({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const{xs:t,sm:o}=ne(),n=G(()=>t.value||o.value),d=Q(),{currentId:r,selectedHighlights:c}=J(d);function _(g){c.value.some(I=>I.id===g.id)?d.removeHighlight(g.id):d.addHighlight(g)}function f(g){return c.value.some(h=>h.id===g.id)}const a=V(null),p=new Map;function v(g,h){h instanceof HTMLElement&&p.set(g,h)}function C(){ue(()=>{const g=p.get(r.value);g&&g.scrollIntoView({behavior:"smooth",block:"center"})})}return W(r,()=>{r.value!=null&&C()}),(g,h)=>(y(),x("div",{ref_key:"containerRef",ref:a,class:"border pa-4 bg-surface overflow-y-auto",style:E({maxHeight:n.value?"25vh":"80vh"})},[h[0]||(h[0]=u("h3",null,"Transcript",-1)),(y(!0),x(M,null,O(e.sections,(I,i)=>(y(),x("div",{key:i},[u("h4",at,P(I.title),1),u("ul",null,[(y(!0),x(M,null,O(I.highlights,(s,m)=>(y(),x("li",{key:m,ref_for:!0,ref:b=>v(s.id,b),onClick:b=>_(s),class:q([{"bg-blue-darken-3":s.id===H(r),"text-grey-lighten-2":f(s)&&s.id===H(r),"text-blue-lighten-1":f(s)&&s.id!==H(r),"border-primary":f(s),"bg-grey-darken-2":s.id!==H(r)},"border-md rounded-lg ma-2 pa-2"])},[u("strong",null,P(s.time)+"s",1),K(" - "+P(s.text),1)],10,ct))),128))]),l(de)]))),128))],4))}}),dt=z(ut,[["__scopeId","data-v-690f554f"]]);async function ft(e){const t=await fetch(`/getSections?duration=${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}const vt=N({__name:"EditorLoader",setup(e){const{xs:t,sm:o}=ne(),n=G(()=>t.value||o.value),d=fe(),r=Q(),c=Xe(),{videoUrl:_}=J(c),f=V([]);return ve(async()=>{if(c.videoDuration===0){c.resetVideo(),d.push("/");return}try{f.value=await ft(c.videoDuration)}catch(a){console.error("Failed to fetchSections:",a)}}),me(()=>{c.resetVideo(),r.resetHighlights(),r.setCurrentId(0)}),(a,p)=>{const v=dt,C=rt;return y(),se(ie,null,{default:k(()=>[l(oe,null,{default:k(()=>[l(A,{cols:"12",md:"6",order:n.value?2:1},{default:k(()=>[l(v,{sections:f.value},null,8,["sections"])]),_:1},8,["order"]),l(A,{class:"mb-5 scroll-y-auto",cols:"12",md:"6",order:n.value?1:2},{default:k(()=>[l(C,{videoUrl:H(_)},null,8,["videoUrl"])]),_:1},8,["order"])]),_:1})]),_:1})}}}),mt=ge("v-alert-title"),gt=["success","info","warning","error"],pt=_e({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Ne,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>gt.includes(e)},...Ae(),...Me(),...Re(),...Le(),...Ee(),...De(),...Be(),...$e(),...we(),...Se({variant:"flat"})},"VAlert"),_t=pe()({name:"VAlert",props:pt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:o,slots:n}=t;const d=he(e,"modelValue"),r=Y(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:c}=ye(e),{colorClasses:_,colorStyles:f,variantClasses:a}=ke(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:p}=xe(e),{dimensionStyles:v}=be(e),{elevationClasses:C}=Ce(e),{locationStyles:g}=Ie(e),{positionClasses:h}=Ve(e),{roundedClasses:I}=Te(e),{textColorClasses:i,textColorStyles:s}=He(()=>e.borderColor),{t:m}=Pe(),b=Y(()=>({"aria-label":m(e.closeLabel),onClick(S){d.value=!1,o("click:close",S)}}));return()=>{const S=!!(n.prepend||r.value),F=!!(n.title||e.title),U=!!(n.close||e.closable);return d.value&&l(e.tag,{class:q(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},c.value,_.value,p.value,C.value,h.value,I.value,a.value,e.class]),style:E([f.value,v.value,g.value,e.style]),role:"alert"},{default:()=>{var L,w;return[ze(!1,"v-alert"),e.border&&u("div",{key:"border",class:q(["v-alert__border",i.value]),style:E(s.value)},null),S&&u("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?l(Z,{key:"prepend-defaults",disabled:!r.value,defaults:{VIcon:{density:e.density,icon:r.value,size:e.prominent?44:28}}},n.prepend):l(Fe,{key:"prepend-icon",density:e.density,icon:r.value,size:e.prominent?44:28},null)]),u("div",{class:"v-alert__content"},[F&&l(mt,{key:"title"},{default:()=>{var $;return[(($=n.title)==null?void 0:$.call(n))??e.title]}}),((L=n.text)==null?void 0:L.call(n))??e.text,(w=n.default)==null?void 0:w.call(n)]),n.append&&u("div",{key:"append",class:"v-alert__append"},[n.append()]),U&&u("div",{key:"close",class:"v-alert__close"},[n.close?l(Z,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var $;return[($=n.close)==null?void 0:$.call(n,{props:b.value})]}}):l(R,Ue({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},b.value),null)])]}})}}}),ht={},yt={class:"border pa-4"},kt={class:"border pa-4"};function xt(e,t){const o=vt;return y(),se(je,null,{default:k(()=>[l(o)]),fallback:k(()=>[l(ie,null,{default:k(()=>[l(oe,null,{default:k(()=>[l(A,null,{default:k(()=>[u("div",yt,[t[0]||(t[0]=u("h3",null,"Transcript",-1)),l(D,{type:"list-item-three-line"}),l(D,{type:"list-item-three-line"}),l(D,{type:"list-item-three-line"})])]),_:1}),l(A,null,{default:k(()=>[u("div",kt,[t[1]||(t[1]=u("h3",null,"Preview",-1)),l(D,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:k(({error:n})=>[l(_t,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:k(()=>[K(" Failed to Load data："+P(n.message),1)]),_:2},1024)]),_:1})}const It=z(ht,[["render",xt]]);export{It as default};
