import{d as M,j as O,h as k,o as _,g as f,F as L,k as F,n as B,t as H,_ as W,l as ne,r as I,m as se,s as q,w as j,p as ie,e as g,q as T,f as oe,i as ee,V as R,v as te,x as le,y as X,z as re,u as ae,A as ce,B as ue,c as de,b as E,C as fe,D as ve,E as me,G as ge,H as J,I as pe,J as he,K as ye,L as _e,M as ke,N as xe,O as be,P as Ce,Q as Ie,R as Ve,T as Te,U as He,W as Pe,X as Se,Y as we,Z as $e,$ as Be,a0 as De,a1 as Ee,a2 as Re,a3 as Le,a4 as Me,a5 as Ae,a6 as K,a7 as Ne}from"./index-xFil4Z08.js";import{b as ze,u as Ue,c as Fe,a as Q,V as je}from"./VSkeletonLoader-DDmSThpi.js";const Xe={class:"timeline bar"},Oe={class:"timeline-info"},We=M({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:t}){const o=e,n=t,c=O(()=>o.duration?o.currentTime/o.duration*100:0);function l(r){const p=Math.floor(r/60),d=Math.floor(r%60);return`${String(p).padStart(2,"0")}:${String(d).padStart(2,"0")}`}function a(r){return o.duration?r/o.duration*100:0}function h(r){if(!o.duration)return 0;const p=o.clipDuration/o.duration*100,d=r!==void 0?a(r):0;return Math.min(p,100-d)}function u(r){const d=r.currentTarget.getBoundingClientRect(),m=(r.clientX-d.left)/d.width,y=o.duration*m;n("seek",y)}return(r,p)=>(_(),k("div",{class:"timeline-wrapper",onClick:p[0]||(p[0]=d=>u(d))},[f("div",Xe,[(_(!0),k(L,null,F(r.highlights,d=>(_(),k("div",{key:d.id,class:"timeline marker bg-primary",style:B({left:a(d.time)+"%",width:h(d.time)+"%"})},null,4))),128))]),f("div",{class:"timeline indicator bg-error",style:B({left:c.value+"%"})},null,4),f("div",Oe,[f("span",null,H(l(r.currentTime)),1),f("span",null,H(l(r.duration)),1)])]))}}),qe=W(We,[["__scopeId","data-v-10da3b86"]]),G=ne("player",()=>{const e=I(null);function t(a){e.value=a}const o=se([]);function n(a){o.some(u=>u.id===a.id)||(o.push(a),o.sort((u,r)=>u.time-r.time))}function c(a){const h=o.findIndex(u=>u.id===a);h>=0&&o.splice(h,1)}function l(){o.splice(0,o.length)}return{currentId:e,setCurrentId:t,selectedHighlights:o,resetHighlights:l,addHighlight:n,removeHighlight:c}});function Ge(e,t){return t?e.find(o=>o.id===t)??null:null}function Y(e,t,o){return e.find(n=>t>=n.time&&t<n.time+o)??null}function $(e,t){return e.findIndex(o=>o.id===t)}function Z(e,t){return(e+1)%t}function Je(e,t){return e<=0?t-1:e-1}function Ke(e,t,o){return e>=t+o}function Qe(e,t){return e>=t}function V(e){return e.value}function z(e,t){e&&(e.currentTime=t)}function Ye(e,t){e&&(e.play(),t.value=!0)}function Ze(e,t){e&&(e.pause(),t.value=!1)}const et={class:"border pa-4 bg-surface"},tt={key:1,class:"position-relative"},nt=["src"],st={key:0,class:"position-absolute left-0 text-caption font-weight-400",style:{translate:"(-50%, 0%)",bottom:"3px"}},it={class:"d-flex justify-space-evenly"},U=5,ot=M({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const t=G(),{currentId:o}=q(t),n=I(null),c=I(0),l=I(null),a=I(!1),h=I(0);function u(){Ye(V(n),a)}function r(){Ze(V(n),a)}function p(){const i=V(n);i&&(i.paused?u():r())}function d(i){const s=t.selectedHighlights.findIndex(v=>v.id===i);s!==-1&&(h.value=s,z(V(n),t.selectedHighlights[s].time))}function b(){const{selectedHighlights:i}=t;if(!i.length||t.currentId==null)return;const s=$(i,t.currentId),v=Je(s,i.length);t.setCurrentId(i[v].id)}function m(){const{selectedHighlights:i}=t;if(!i.length||t.currentId==null)return;const s=$(i,t.currentId),v=Z(s,i.length);t.setCurrentId(i[v].id)}function y(){const i=V(n);if(!i)return;c.value=i.currentTime;const s=Y(t.selectedHighlights,c.value,U);s?(l.value=s,t.currentId!==s.id&&t.setCurrentId(s.id)):l.value=null;const v=Ge(t.selectedHighlights,t.currentId);if(!v)return;const x=$(t.selectedHighlights,v.id)===t.selectedHighlights.length-1,P=Ke(c.value,v.time,U),A=Qe(c.value,i.duration);if(P||x&&A){const N=$(t.selectedHighlights,v.id),D=Z(N,t.selectedHighlights.length),S=t.selectedHighlights[D];t.setCurrentId(S.id),z(i,S.time),u()}}j(c,i=>{const s=Y(t.selectedHighlights,i,U);l.value=s,h.value=s?$(t.selectedHighlights,s.id):0}),j(()=>t.currentId,i=>{i!=null&&d(i)}),ie(()=>{const i=t.selectedHighlights,s=V(n);s&&(i.length?(i.length===1||!i.some(v=>v.id===t.currentId))&&(t.setCurrentId(i[0].id),s.paused&&u()):(c.value=0,r(),t.setCurrentId(0)))});function C(i){z(V(n),i)}return(i,s)=>{var x;const v=qe;return _(),k("div",et,[s[2]||(s[2]=f("h3",null,"Preview",-1)),T(t).selectedHighlights.length===0?(_(),k(L,{key:0},[s[0]||(s[0]=f("p",{class:"text-grey-darken-3"},"Please select a highlight!",-1)),g(ze,{boilerplate:"",type:"image",class:"mt-4 mb-8"})],64)):(_(),k("div",tt,[f("video",{ref_key:"videoRef",ref:n,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:y},s[1]||(s[1]=[f("source",{type:"video/*"},null,-1),ee(" The browser doesn't support HTML5 video. ")]),40,nt),l.value?(_(),k("div",st,H(l.value.text),1)):oe("",!0)])),g(v,{currentTime:c.value,duration:((x=n.value)==null?void 0:x.duration)||0,highlights:T(t).selectedHighlights,clipDuration:5,onSeek:C},null,8,["currentTime","duration","highlights"]),f("div",it,[g(R,{icon:"mdi-chevron-double-left",onClick:b,variant:"text"}),g(R,{icon:a.value?"mdi-pause":"mdi-play",onClick:p,variant:"text"},null,8,["icon"]),g(R,{icon:"mdi-chevron-double-right",onClick:m,variant:"text"})])])}}}),lt=W(ot,[["__scopeId","data-v-1f4e5a8c"]]),rt={class:"py-2"},at=["onClick"],ct=M({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const{xs:t,sm:o}=te(),n=O(()=>t.value||o.value),c=G(),{currentId:l,selectedHighlights:a}=q(c);function h(m){a.value.some(C=>C.id===m.id)?c.removeHighlight(m.id):c.addHighlight(m)}function u(m){return a.value.some(y=>y.id===m.id)}const r=I(null),p=new Map;function d(m,y){y instanceof HTMLElement&&p.set(m,y)}function b(){le(()=>{const m=p.get(l.value);m&&m.scrollIntoView({behavior:"smooth",block:"center"})})}return j(l,()=>{l.value!=null&&b()}),(m,y)=>(_(),k("div",{ref_key:"containerRef",ref:r,class:"border pa-4 bg-surface overflow-y-auto",style:B({maxHeight:n.value?"25vh":"80vh"})},[y[0]||(y[0]=f("h3",null,"Transcript",-1)),(_(!0),k(L,null,F(e.sections,(C,i)=>(_(),k("div",{key:i},[f("h4",rt,H(C.title),1),f("ul",null,[(_(!0),k(L,null,F(C.highlights,(s,v)=>(_(),k("li",{key:v,ref_for:!0,ref:x=>d(s.id,x),onClick:x=>h(s),class:X([{"bg-blue-darken-3":s.id===T(l),"text-grey-lighten-2":u(s)&&s.id===T(l),"text-blue-lighten-1":u(s)&&s.id!==T(l),"border-primary":u(s),"bg-grey-darken-2":s.id!==T(l)},"border-md rounded-lg ma-2 pa-2"])},[f("strong",null,H(s.time)+"s",1),ee(" - "+H(s.text),1)],10,at))),128))]),g(re)]))),128))],4))}}),ut=W(ct,[["__scopeId","data-v-690f554f"]]);async function dt(e){const t=await fetch(`/getSections?duration=${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}const ht=M({__name:"EditorLoader",setup(e){const{xs:t,sm:o}=te(),n=O(()=>t.value||o.value),c=ae(),l=G(),a=Ue(),{videoUrl:h}=q(a),u=I([]);return ce(async()=>{if(a.videoDuration===0){a.resetVideo(),c.push("/");return}try{u.value=await dt(a.videoDuration)}catch(r){console.error("Failed to fetchSections:",r)}}),ue(()=>{a.resetVideo(),l.resetHighlights(),l.setCurrentId(0)}),(r,p)=>{const d=ut,b=lt;return _(),de(Fe,null,{default:E(()=>[g(je,null,{default:E(()=>[g(Q,{cols:"12",md:"6",order:n.value?2:1},{default:E(()=>[g(d,{sections:u.value},null,8,["sections"])]),_:1},8,["order"]),g(Q,{class:"mb-5 scroll-y-auto",cols:"12",md:"6",order:n.value?1:2},{default:E(()=>[g(b,{videoUrl:T(h)},null,8,["videoUrl"])]),_:1},8,["order"])]),_:1})]),_:1})}}}),ft=fe("v-alert-title"),vt=["success","info","warning","error"],mt=me({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Le,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>vt.includes(e)},...Re(),...Ee(),...De(),...Be(),...$e(),...we(),...Se(),...Pe(),...He(),...Te({variant:"flat"})},"VAlert"),yt=ve()({name:"VAlert",props:mt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:o,slots:n}=t;const c=ge(e,"modelValue"),l=J(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:a}=pe(e),{colorClasses:h,colorStyles:u,variantClasses:r}=he(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:p}=ye(e),{dimensionStyles:d}=_e(e),{elevationClasses:b}=ke(e),{locationStyles:m}=xe(e),{positionClasses:y}=be(e),{roundedClasses:C}=Ce(e),{textColorClasses:i,textColorStyles:s}=Ie(()=>e.borderColor),{t:v}=Ve(),x=J(()=>({"aria-label":v(e.closeLabel),onClick(P){c.value=!1,o("click:close",P)}}));return()=>{const P=!!(n.prepend||l.value),A=!!(n.title||e.title),N=!!(n.close||e.closable);return c.value&&g(e.tag,{class:X(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},a.value,h.value,p.value,b.value,y.value,C.value,r.value,e.class]),style:B([u.value,d.value,m.value,e.style]),role:"alert"},{default:()=>{var D,S;return[Me(!1,"v-alert"),e.border&&f("div",{key:"border",class:X(["v-alert__border",i.value]),style:B(s.value)},null),P&&f("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?g(K,{key:"prepend-defaults",disabled:!l.value,defaults:{VIcon:{density:e.density,icon:l.value,size:e.prominent?44:28}}},n.prepend):g(Ae,{key:"prepend-icon",density:e.density,icon:l.value,size:e.prominent?44:28},null)]),f("div",{class:"v-alert__content"},[A&&g(ft,{key:"title"},{default:()=>{var w;return[((w=n.title)==null?void 0:w.call(n))??e.title]}}),((D=n.text)==null?void 0:D.call(n))??e.text,(S=n.default)==null?void 0:S.call(n)]),n.append&&f("div",{key:"append",class:"v-alert__append"},[n.append()]),N&&f("div",{key:"close",class:"v-alert__close"},[n.close?g(K,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var w;return[(w=n.close)==null?void 0:w.call(n,{props:x.value})]}}):g(R,Ne({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},x.value),null)])]}})}}});export{yt as V,ht as _};
