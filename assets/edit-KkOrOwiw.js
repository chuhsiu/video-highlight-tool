import{d as M,j as ee,h as k,o as _,g as f,F as R,k as j,n as E,t as S,_ as z,l as te,r as I,m as ne,s as W,w as O,p as se,e as a,q as V,i as L,f as ie,V as D,v as le,x as X,y as oe,u as ae,z as re,A as ce,c as K,b as y,B as ue,C as de,D as fe,E as ve,G,H as me,I as ge,J as pe,K as he,L as _e,M as ye,N as ke,O as xe,P as be,Q as Ce,R as Te,S as He,T as Ie,U as Ve,W as Se,X as Pe,Y as we,Z as $e,$ as Be,a0 as De,a1 as Re,a2 as Ee,a3 as Le,a4 as J,a5 as Ae,a6 as Me}from"./index-DCzkLXhN.js";import{b as $,u as ze,c as Q,a as A,V as Y}from"./VSkeletonLoader-C4jCEJqt.js";const Ne={class:"timeline bar"},Ue={class:"timeline-info"},Fe=M({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:n}){const i=e,t=n,v=ee(()=>i.duration?i.currentTime/i.duration*100:0);function r(d){const c=Math.floor(d/60),o=Math.floor(d%60);return`${String(c).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function u(d){return i.duration?d/i.duration*100:0}function g(d){if(!i.duration)return 0;const c=i.clipDuration/i.duration*100,o=d!==void 0?u(d):0;return Math.min(c,100-o)}function h(d){const o=d.currentTarget.getBoundingClientRect(),C=(d.clientX-o.left)/o.width,s=i.duration*C;t("seek",s)}return(d,c)=>(_(),k("div",{class:"timeline-wrapper",onClick:c[0]||(c[0]=o=>h(o))},[f("div",Ne,[(_(!0),k(R,null,j(d.highlights,o=>(_(),k("div",{key:o.id,class:"timeline marker bg-primary",style:E({left:u(o.time)+"%",width:g(o.time)+"%"})},null,4))),128))]),f("div",{class:"timeline indicator bg-error",style:E({left:v.value+"%"})},null,4),f("div",Ue,[f("span",null,S(r(d.currentTime)),1),f("span",null,S(r(d.duration)),1)])]))}}),je=z(Fe,[["__scopeId","data-v-10da3b86"]]),q=te("player",()=>{const e=I(null);function n(u){e.value=u}const i=ne([]);function t(u){i.some(h=>h.id===u.id)||(i.push(u),i.sort((h,d)=>h.time-d.time))}function v(u){const g=i.findIndex(h=>h.id===u);g>=0&&i.splice(g,1)}function r(){i.splice(0,i.length)}return{currentId:e,setCurrentId:n,selectedHighlights:i,resetHighlights:r,addHighlight:t,removeHighlight:v}}),Oe={class:"border pa-4 bg-surface",style:{height:"80vh"}},Xe={key:1,style:{position:"relative"}},We=["src"],qe={key:0,class:"position-absolute left-0 bottom-0 text-caption font-weight-400",style:{translate:"(-50%, 0%)"}},Ge={class:"d-flex justify-space-evenly"},F=5,Je=M({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const n=q(),{currentId:i}=W(n),t=I(null),v=I(0),r=I(null),u=I(!1),g=I(0);function h(){t.value&&(t.value.paused?(t.value.play(),u.value=!0):(t.value.pause(),u.value=!1))}function d(s){const l=n.selectedHighlights.findIndex(p=>p.id===s);if(l===-1)return;const m=n.selectedHighlights[l];g.value=l,t.value&&(t.value.currentTime=m.time)}function c(){if(n.selectedHighlights.length===0||i.value==null)return;const s=n.selectedHighlights.findIndex(p=>p.id===i.value);if(s===-1)return;const l=s===0?n.selectedHighlights.length-1:s-1,m=n.selectedHighlights[l];n.setCurrentId(m.id)}function o(){if(n.selectedHighlights.length===0||i.value==null)return;const s=n.selectedHighlights.findIndex(p=>p.id===i.value);if(s===-1)return;const l=(s+1)%n.selectedHighlights.length,m=n.selectedHighlights[l];n.setCurrentId(m.id)}function x(){if(!t.value)return;const s=t.value;v.value=s.currentTime;const{selectedHighlights:l}=n,m=s.duration,p=v.value;if(!l.length)return;const P=l.find(b=>p>=b.time&&p<b.time+F);P?(r.value=P,i.value!==P.id&&n.setCurrentId(P.id)):r.value=null;const T=l.find(b=>b.id===i.value);if(!T)return;const w=l.findIndex(b=>b.id===T.id)===l.length-1,N=p>=T.time+F,U=p>=m;if(N||w&&U){if(l.length===1)s.currentTime=T.time;else{const B=(l.findIndex(Z=>Z.id===T.id)+1)%l.length,H=l[B];n.setCurrentId(H.id),s.currentTime=H.time}t.value.play(),u.value=!0}}O(v,s=>{const l=n.selectedHighlights.findIndex(m=>s>=m.time&&s<=m.time+F);l!==-1?(r.value=n.selectedHighlights[l],g.value=l):r.value=null}),O(i,s=>{d(s)}),se(()=>{const s=n.selectedHighlights;t.value&&(s.length===0?(v.value=0,t.value.pause(),u.value=!1,n.setCurrentId(0)):(s.length===1||!s.some(l=>l.id===i.value))&&(n.setCurrentId(s[0].id),t.value.paused&&(t.value.play(),u.value=!0)))});function C(s){t.value&&(t.value.currentTime=s)}return(s,l)=>{var p;const m=je;return _(),k("div",Oe,[l[2]||(l[2]=f("h3",null,"Preview",-1)),V(n).selectedHighlights.length===0?(_(),k(R,{key:0},[l[0]||(l[0]=L(" 尚未選擇片段 ")),a($,{boilerplate:"",type:"image",class:"ma-4"})],64)):(_(),k("div",Xe,[f("video",{ref_key:"videoRef",ref:t,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:x},l[1]||(l[1]=[f("source",{type:"video/*"},null,-1),L(" The browser doesn't support HTML5 video. ")]),40,We),r.value?(_(),k("div",qe,S(r.value.text),1)):ie("",!0)])),a(m,{currentTime:v.value,duration:((p=t.value)==null?void 0:p.duration)||0,highlights:V(n).selectedHighlights,clipDuration:5,onSeek:C},null,8,["currentTime","duration","highlights"]),f("div",Ge,[a(D,{icon:"mdi-chevron-double-left",onClick:c,variant:"text"}),a(D,{icon:u.value?"mdi-pause":"mdi-play",onClick:h,variant:"text"},null,8,["icon"]),a(D,{icon:"mdi-chevron-double-right",onClick:o,variant:"text"})])])}}}),Ke=z(Je,[["__scopeId","data-v-c4e8df79"]]),Qe={class:"py-2"},Ye=["onClick"],Ze=M({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const n=q(),{currentId:i,selectedHighlights:t}=W(n);function v(c){t.value.some(x=>x.id===c.id)?n.removeHighlight(c.id):n.addHighlight(c)}function r(c){return t.value.some(o=>o.id===c.id)}const u=I(null),g=new Map;function h(c,o){o instanceof HTMLElement&&g.set(c,o)}function d(){le(()=>{const c=g.get(i.value),o=u.value;if(c&&o){const x=c.offsetTop,C=c.offsetHeight,s=o.clientHeight,l=x-s/2+C/2;o.scrollTo({top:l,behavior:"smooth"})}})}return O(i,()=>{i.value!=null&&d()}),(c,o)=>(_(),k("div",{class:"border pa-4 bg-surface editor-container",ref_key:"containerRef",ref:u},[o[0]||(o[0]=f("h3",null,"Transcript",-1)),(_(!0),k(R,null,j(e.sections,(x,C)=>(_(),k("div",{key:C},[f("h4",Qe,S(x.title),1),f("ul",null,[(_(!0),k(R,null,j(x.highlights,(s,l)=>(_(),k("li",{key:l,ref_for:!0,ref:m=>h(s.id,m),onClick:m=>v(s),class:X([{"bg-blue-darken-3":s.id===V(i),"text-grey-lighten-2":r(s)&&s.id===V(i),"text-blue-lighten-1":r(s)&&s.id!==V(i),"border-primary":r(s),"bg-grey-darken-2":s.id!==V(i)},"border-md rounded-lg ma-2 pa-2"])},[f("strong",null,S(s.time)+"s",1),L(" - "+S(s.text),1)],10,Ye))),128))]),a(oe)]))),128))],512))}}),et=z(Ze,[["__scopeId","data-v-1fa71dda"]]);async function tt(e){const n=await fetch(`/getSections?duration=${e}`);if(!n.ok)throw new Error("Network response was not ok");return await n.json()}const nt=M({__name:"EditorLoader",async setup(e){let n,i;const t=ae(),v=q(),r=ze(),{videoUrl:u}=W(r);r.videoDuration==0&&(r.resetVideo(),t.push("/"));const g=I(([n,i]=re(()=>tt(r.videoDuration)),n=await n,i(),n));return ce(()=>{r.resetVideo(),v.resetHighlights(),v.setCurrentId(0)}),(h,d)=>{const c=et,o=Ke;return _(),K(Q,null,{default:y(()=>[a(Y,null,{default:y(()=>[a(A,null,{default:y(()=>[a(c,{sections:g.value},null,8,["sections"])]),_:1}),a(A,null,{default:y(()=>[a(o,{videoUrl:V(u)},null,8,["videoUrl"])]),_:1})]),_:1})]),_:1})}}}),st=ue("v-alert-title"),it=["success","info","warning","error"],lt=fe({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Re,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>it.includes(e)},...De(),...Be(),...$e(),...we(),...Pe(),...Se(),...Ve(),...Ie(),...He(),...Te({variant:"flat"})},"VAlert"),ot=de()({name:"VAlert",props:lt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,n){let{emit:i,slots:t}=n;const v=ve(e,"modelValue"),r=G(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:u}=me(e),{colorClasses:g,colorStyles:h,variantClasses:d}=ge(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:c}=pe(e),{dimensionStyles:o}=he(e),{elevationClasses:x}=_e(e),{locationStyles:C}=ye(e),{positionClasses:s}=ke(e),{roundedClasses:l}=xe(e),{textColorClasses:m,textColorStyles:p}=be(()=>e.borderColor),{t:P}=Ce(),T=G(()=>({"aria-label":P(e.closeLabel),onClick(w){v.value=!1,i("click:close",w)}}));return()=>{const w=!!(t.prepend||r.value),N=!!(t.title||e.title),U=!!(t.close||e.closable);return v.value&&a(e.tag,{class:X(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},u.value,g.value,c.value,x.value,s.value,l.value,d.value,e.class]),style:E([h.value,o.value,C.value,e.style]),role:"alert"},{default:()=>{var b,B;return[Ee(!1,"v-alert"),e.border&&f("div",{key:"border",class:X(["v-alert__border",m.value]),style:E(p.value)},null),w&&f("div",{key:"prepend",class:"v-alert__prepend"},[t.prepend?a(J,{key:"prepend-defaults",disabled:!r.value,defaults:{VIcon:{density:e.density,icon:r.value,size:e.prominent?44:28}}},t.prepend):a(Le,{key:"prepend-icon",density:e.density,icon:r.value,size:e.prominent?44:28},null)]),f("div",{class:"v-alert__content"},[N&&a(st,{key:"title"},{default:()=>{var H;return[((H=t.title)==null?void 0:H.call(t))??e.title]}}),((b=t.text)==null?void 0:b.call(t))??e.text,(B=t.default)==null?void 0:B.call(t)]),t.append&&f("div",{key:"append",class:"v-alert__append"},[t.append()]),U&&f("div",{key:"close",class:"v-alert__close"},[t.close?a(J,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var H;return[(H=t.close)==null?void 0:H.call(t,{props:T.value})]}}):a(D,Ae({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},T.value),null)])]}})}}}),at={},rt={class:"border pa-4"},ct={class:"border pa-4"};function ut(e,n){const i=nt;return _(),K(Me,null,{default:y(()=>[a(i)]),fallback:y(()=>[a(Q,null,{default:y(()=>[a(Y,null,{default:y(()=>[a(A,null,{default:y(()=>[f("div",rt,[n[0]||(n[0]=f("h3",null,"Transcript",-1)),a($,{type:"list-item-three-line"}),a($,{type:"list-item-three-line"}),a($,{type:"list-item-three-line"})])]),_:1}),a(A,null,{default:y(()=>[f("div",ct,[n[1]||(n[1]=f("h3",null,"Preview",-1)),a($,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:y(({error:t})=>[a(ot,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:y(()=>[L(" 發生錯誤："+S(t.message),1)]),_:2},1024)]),_:1})}const vt=z(at,[["render",ut]]);export{vt as default};
