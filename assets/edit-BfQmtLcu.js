import{d as z,j as te,h as x,o as _,g as f,F as L,k as W,n as M,t as S,_ as U,l as oe,r as C,m as le,s as J,w as q,p as re,e as r,q as H,i as A,f as ae,V as R,v as ce,x as G,y as ue,z as de,u as fe,A as ve,B as me,c as ne,b as k,C as ge,D as pe,E as he,G as _e,H as Q,I as ye,J as ke,K as xe,L as be,M as Ce,N as Ie,O as Te,P as Ve,Q as He,R as Se,S as Pe,T as we,U as $e,W as Be,X as De,Y as Ee,Z as Re,$ as Le,a0 as Me,a1 as Ae,a2 as Ne,a3 as ze,a4 as Ue,a5 as Y,a6 as Fe,a7 as je}from"./index-CIgGyLae.js";import{b as D,u as Oe,c as se,a as N,V as ie}from"./VSkeletonLoader-B6U6Oqio.js";const Xe={class:"timeline bar"},We={class:"timeline-info"},qe=z({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:t}){const s=e,n=t,m=te(()=>s.duration?s.currentTime/s.duration*100:0);function d(a){const c=Math.floor(a/60),o=Math.floor(a%60);return`${String(c).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function u(a){return s.duration?a/s.duration*100:0}function h(a){if(!s.duration)return 0;const c=s.clipDuration/s.duration*100,o=a!==void 0?u(a):0;return Math.min(c,100-o)}function g(a){const o=a.currentTarget.getBoundingClientRect(),b=(a.clientX-o.left)/o.width,v=s.duration*b;n("seek",v)}return(a,c)=>(_(),x("div",{class:"timeline-wrapper",onClick:c[0]||(c[0]=o=>g(o))},[f("div",Xe,[(_(!0),x(L,null,W(a.highlights,o=>(_(),x("div",{key:o.id,class:"timeline marker bg-primary",style:M({left:u(o.time)+"%",width:h(o.time)+"%"})},null,4))),128))]),f("div",{class:"timeline indicator bg-error",style:M({left:m.value+"%"})},null,4),f("div",We,[f("span",null,S(d(a.currentTime)),1),f("span",null,S(d(a.duration)),1)])]))}}),Ge=U(qe,[["__scopeId","data-v-10da3b86"]]),K=oe("player",()=>{const e=C(null);function t(u){e.value=u}const s=le([]);function n(u){s.some(g=>g.id===u.id)||(s.push(u),s.sort((g,a)=>g.time-a.time))}function m(u){const h=s.findIndex(g=>g.id===u);h>=0&&s.splice(h,1)}function d(){s.splice(0,s.length)}return{currentId:e,setCurrentId:t,selectedHighlights:s,resetHighlights:d,addHighlight:n,removeHighlight:m}});function Je(e,t){return t?e.find(s=>s.id===t)??null:null}function Z(e,t,s){return e.find(n=>t>=n.time&&t<n.time+s)??null}function B(e,t){return e.findIndex(s=>s.id===t)}function ee(e,t){return(e+1)%t}function Ke(e,t){return e<=0?t-1:e-1}function Qe(e,t,s){return e>=t+s}function Ye(e,t){return e>=t}function V(e){return e.value}function O(e,t){e&&(e.currentTime=t)}function Ze(e,t){e&&(e.play(),t.value=!0)}function et(e,t){e&&(e.pause(),t.value=!1)}const tt={class:"border pa-4 bg-surface relative"},nt={key:1,class:"relative"},st=["src"],it={key:0,class:"position-absolute left-0 bottom-0 text-caption font-weight-400",style:{translate:"(-50%, 0%)"}},ot={class:"d-flex justify-space-evenly"},X=5,lt=z({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const t=K(),{currentId:s}=J(t),n=C(null),m=C(0),d=C(null),u=C(!1),h=C(0);function g(){Ze(V(n),u)}function a(){et(V(n),u)}function c(){const i=V(n);i&&(i.paused?g():a())}function o(i){const l=t.selectedHighlights.findIndex(p=>p.id===i);l!==-1&&(h.value=l,O(V(n),t.selectedHighlights[l].time))}function y(){const{selectedHighlights:i}=t;if(!i.length||t.currentId==null)return;const l=B(i,t.currentId),p=Ke(l,i.length);t.setCurrentId(i[p].id)}function b(){const{selectedHighlights:i}=t;if(!i.length||t.currentId==null)return;const l=B(i,t.currentId),p=ee(l,i.length);t.setCurrentId(i[p].id)}function v(){const i=V(n);if(!i)return;m.value=i.currentTime;const l=Z(t.selectedHighlights,m.value,X);l?(d.value=l,t.currentId!==l.id&&t.setCurrentId(l.id)):d.value=null;const p=Je(t.selectedHighlights,t.currentId);if(!p)return;const T=B(t.selectedHighlights,p.id)===t.selectedHighlights.length-1,P=Qe(m.value,p.time,X),F=Ye(m.value,i.duration);if(P||T&&F){const j=B(t.selectedHighlights,p.id),E=ee(j,t.selectedHighlights.length),w=t.selectedHighlights[E];t.setCurrentId(w.id),O(i,w.time),g()}}q(m,i=>{const l=Z(t.selectedHighlights,i,X);d.value=l,h.value=l?B(t.selectedHighlights,l.id):0}),q(()=>t.currentId,i=>{i!=null&&o(i)}),re(()=>{const i=t.selectedHighlights,l=V(n);l&&(i.length?(i.length===1||!i.some(p=>p.id===t.currentId))&&(t.setCurrentId(i[0].id),l.paused&&g()):(m.value=0,a(),t.setCurrentId(0)))});function I(i){O(V(n),i)}return(i,l)=>{var T;const p=Ge;return _(),x("div",tt,[l[2]||(l[2]=f("h3",null,"Preview",-1)),H(t).selectedHighlights.length===0?(_(),x(L,{key:0},[l[0]||(l[0]=A(" 尚未選擇片段 ")),r(D,{boilerplate:"",type:"image",class:"ma-4"})],64)):(_(),x("div",nt,[f("video",{ref_key:"videoRef",ref:n,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:v},l[1]||(l[1]=[f("source",{type:"video/*"},null,-1),A(" The browser doesn't support HTML5 video. ")]),40,st),d.value?(_(),x("div",it,S(d.value.text),1)):ae("",!0)])),r(p,{currentTime:m.value,duration:((T=n.value)==null?void 0:T.duration)||0,highlights:H(t).selectedHighlights,clipDuration:5,onSeek:I},null,8,["currentTime","duration","highlights"]),f("div",ot,[r(R,{icon:"mdi-chevron-double-left",onClick:y,variant:"text"}),r(R,{icon:u.value?"mdi-pause":"mdi-play",onClick:c,variant:"text"},null,8,["icon"]),r(R,{icon:"mdi-chevron-double-right",onClick:b,variant:"text"})])])}}}),rt=U(lt,[["__scopeId","data-v-7395c89d"]]),at={class:"py-2"},ct=["onClick"],ut=z({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const t=K(),{currentId:s,selectedHighlights:n}=J(t);function m(c){n.value.some(y=>y.id===c.id)?t.removeHighlight(c.id):t.addHighlight(c)}function d(c){return n.value.some(o=>o.id===c.id)}const u=C(null),h=new Map;function g(c,o){o instanceof HTMLElement&&h.set(c,o)}function a(){ce(()=>{const c=h.get(s.value),o=u.value;if(c&&o){const y=c.offsetTop,b=c.offsetHeight,v=o.clientHeight,I=y-v/2+b/2;o.scrollTo({top:I,behavior:"smooth"})}})}return q(s,()=>{s.value!=null&&a()}),(c,o)=>(_(),x("div",{ref_key:"containerRef",ref:u,class:"border pa-4 bg-surface overflow-y-auto",style:{"max-height":"100vh"}},[o[0]||(o[0]=f("h3",null,"Transcript",-1)),(_(!0),x(L,null,W(e.sections,(y,b)=>(_(),x("div",{key:b},[f("h4",at,S(y.title),1),f("ul",null,[(_(!0),x(L,null,W(y.highlights,(v,I)=>(_(),x("li",{key:I,ref_for:!0,ref:i=>g(v.id,i),onClick:i=>m(v),class:G([{"bg-blue-darken-3":v.id===H(s),"text-grey-lighten-2":d(v)&&v.id===H(s),"text-blue-lighten-1":d(v)&&v.id!==H(s),"border-primary":d(v),"bg-grey-darken-2":v.id!==H(s)},"border-md rounded-lg ma-2 pa-2"])},[f("strong",null,S(v.time)+"s",1),A(" - "+S(v.text),1)],10,ct))),128))]),r(ue)]))),128))],512))}}),dt=U(ut,[["__scopeId","data-v-02392ea6"]]);async function ft(e){const t=await fetch(`/getSections?duration=${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}const vt=z({__name:"EditorLoader",setup(e){const{xs:t,sm:s}=de(),n=te(()=>t.value||s.value),m=fe(),d=K(),u=Oe(),{videoUrl:h}=J(u),g=C([]);return ve(async()=>{if(u.videoDuration===0){u.resetVideo(),m.push("/");return}try{g.value=await ft(u.videoDuration)}catch(a){console.error("Failed to fetchSections:",a)}}),me(()=>{u.resetVideo(),d.resetHighlights(),d.setCurrentId(0)}),(a,c)=>{const o=dt,y=rt;return _(),ne(se,null,{default:k(()=>[r(ie,null,{default:k(()=>[r(N,{cols:"12",md:"6",order:n.value?2:1},{default:k(()=>[r(o,{sections:g.value},null,8,["sections"])]),_:1},8,["order"]),r(N,{class:"mb-5 scroll-y-auto",cols:"12",md:"6",order:n.value?1:2},{default:k(()=>[r(y,{videoUrl:H(h)},null,8,["videoUrl"])]),_:1},8,["order"])]),_:1})]),_:1})}}}),mt=ge("v-alert-title"),gt=["success","info","warning","error"],pt=he({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Ne,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>gt.includes(e)},...Ae(),...Me(),...Le(),...Re(),...Ee(),...De(),...Be(),...$e(),...we(),...Pe({variant:"flat"})},"VAlert"),ht=pe()({name:"VAlert",props:pt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:s,slots:n}=t;const m=_e(e,"modelValue"),d=Q(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:u}=ye(e),{colorClasses:h,colorStyles:g,variantClasses:a}=ke(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:c}=xe(e),{dimensionStyles:o}=be(e),{elevationClasses:y}=Ce(e),{locationStyles:b}=Ie(e),{positionClasses:v}=Te(e),{roundedClasses:I}=Ve(e),{textColorClasses:i,textColorStyles:l}=He(()=>e.borderColor),{t:p}=Se(),T=Q(()=>({"aria-label":p(e.closeLabel),onClick(P){m.value=!1,s("click:close",P)}}));return()=>{const P=!!(n.prepend||d.value),F=!!(n.title||e.title),j=!!(n.close||e.closable);return m.value&&r(e.tag,{class:G(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},u.value,h.value,c.value,y.value,v.value,I.value,a.value,e.class]),style:M([g.value,o.value,b.value,e.style]),role:"alert"},{default:()=>{var E,w;return[ze(!1,"v-alert"),e.border&&f("div",{key:"border",class:G(["v-alert__border",i.value]),style:M(l.value)},null),P&&f("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?r(Y,{key:"prepend-defaults",disabled:!d.value,defaults:{VIcon:{density:e.density,icon:d.value,size:e.prominent?44:28}}},n.prepend):r(Ue,{key:"prepend-icon",density:e.density,icon:d.value,size:e.prominent?44:28},null)]),f("div",{class:"v-alert__content"},[F&&r(mt,{key:"title"},{default:()=>{var $;return[(($=n.title)==null?void 0:$.call(n))??e.title]}}),((E=n.text)==null?void 0:E.call(n))??e.text,(w=n.default)==null?void 0:w.call(n)]),n.append&&f("div",{key:"append",class:"v-alert__append"},[n.append()]),j&&f("div",{key:"close",class:"v-alert__close"},[n.close?r(Y,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var $;return[($=n.close)==null?void 0:$.call(n,{props:T.value})]}}):r(R,Fe({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},T.value),null)])]}})}}}),_t={},yt={class:"border pa-4"},kt={class:"border pa-4"};function xt(e,t){const s=vt;return _(),ne(je,null,{default:k(()=>[r(s)]),fallback:k(()=>[r(se,null,{default:k(()=>[r(ie,null,{default:k(()=>[r(N,null,{default:k(()=>[f("div",yt,[t[0]||(t[0]=f("h3",null,"Transcript",-1)),r(D,{type:"list-item-three-line"}),r(D,{type:"list-item-three-line"}),r(D,{type:"list-item-three-line"})])]),_:1}),r(N,null,{default:k(()=>[f("div",kt,[t[1]||(t[1]=f("h3",null,"Preview",-1)),r(D,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:k(({error:n})=>[r(ht,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:k(()=>[A(" 發生錯誤："+S(n.message),1)]),_:2},1024)]),_:1})}const It=U(_t,[["render",xt]]);export{It as default};
