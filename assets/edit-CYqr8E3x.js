import{d as L,w as $,j as Z,h as k,o as _,g as m,F as S,k as N,n as B,t as T,_ as E,l as ee,r as C,m as te,s as F,p as ne,q as H,i as D,e as a,f as se,V as w,v as ie,x as U,y as le,u as oe,z as ae,A as re,c as q,b as y,B as ce,C as ue,D as de,E as fe,G as j,H as ve,I as me,J as ge,K as he,L as _e,M as pe,N as ye,O as ke,P as xe,Q as be,R as Ce,S as He,T as Te,U as Ve,W as Ie,X as Se,Y as Pe,Z as we,$ as $e,a0 as Be,a1 as De,a2 as Re,a3 as Le,a4 as W,a5 as Ee,a6 as Ae}from"./index-Hg-_rjbU.js";import{b as I,u as ze,c as G,a as R,V as J}from"./VSkeletonLoader-CWT9TX4E.js";const Me={class:"timeline bar"},Ne={class:"timeline-info"},Ue=L({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:t}){const s=e,n=t;$(s.highlights,r=>{console.log("h c :"+r)});const f=Z(()=>s.duration?s.currentTime/s.duration*100:0);function v(r){const c=Math.floor(r/60),o=Math.floor(r%60);return`${String(c).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function u(r){return s.duration?r/s.duration*100:0}function g(r){if(!s.duration)return 0;const c=s.clipDuration/s.duration*100,o=r!==void 0?u(r):0;return Math.min(c,100-o)}function h(r){const o=r.currentTarget.getBoundingClientRect(),b=(r.clientX-o.left)/o.width,i=s.duration*b;n("seek",i)}return(r,c)=>(_(),k("div",{class:"timeline-wrapper",onClick:c[0]||(c[0]=o=>h(o))},[m("div",Me,[(_(!0),k(S,null,N(r.highlights,o=>(_(),k("div",{key:o.id,class:"timeline marker",style:B({left:u(o.time)+"%",width:g(o.time)+"%"})},null,4))),128))]),m("div",{class:"timeline indicator",style:B({left:f.value+"%"})},null,4),m("div",Ne,[m("span",null,T(v(r.currentTime)),1),m("span",null,T(v(r.duration)),1)])]))}}),Fe=E(Ue,[["__scopeId","data-v-a9c65f18"]]),K=ee("player",()=>{const e=C(null);function t(u){e.value=u}const s=te([]);function n(u){s.some(h=>h.id===u.id)||(s.push(u),s.sort((h,r)=>h.time-r.time))}function f(u){const g=s.findIndex(h=>h.id===u);g>=0&&s.splice(g,1)}function v(u){s.splice(0,s.length,...u.sort((g,h)=>g.time-h.time))}return{currentId:e,setCurrentId:t,selectedHighlights:s,setHighlights:v,addHighlight:n,removeHighlight:f}}),Oe={class:"border pa-4"},Xe={style:{position:"relative"}},je=["src"],We={key:0,style:{position:"absolute",left:"0",bottom:"0",translate:"(-50%, 0%)","font-size":"10px","font-weight":"300"}},M=5,qe=L({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const t=K(),{currentId:s}=F(t),n=C(null),f=C(0),v=C(null),u=C(!1),g=C(0);function h(){n.value&&(n.value.paused?(n.value.play(),u.value=!0):(n.value.pause(),u.value=!1))}function r(i){const l=t.selectedHighlights.findIndex(p=>p.id===i);if(l===-1)return;const d=t.selectedHighlights[l];g.value=l,n.value&&(n.value.currentTime=d.time)}function c(){if(t.selectedHighlights.length===0||s.value==null)return;const i=t.selectedHighlights.findIndex(p=>p.id===s.value);if(i===-1)return;const l=i===0?t.selectedHighlights.length-1:i-1,d=t.selectedHighlights[l];t.setCurrentId(d.id)}function o(){if(t.selectedHighlights.length===0||s.value==null)return;const i=t.selectedHighlights.findIndex(p=>p.id===s.value);if(i===-1)return;const l=(i+1)%t.selectedHighlights.length,d=t.selectedHighlights[l];t.setCurrentId(d.id)}function x(){if(!n.value)return;f.value=n.value.currentTime;const i=t.selectedHighlights.find(d=>f.value>=d.time&&f.value<d.time+M);i?(v.value=i,s.value!==i.id&&t.setCurrentId(i.id)):v.value=null;const l=t.selectedHighlights.find(d=>d.id===s.value);if(l&&f.value>=l.time+M){const d=t.selectedHighlights.findIndex(P=>P.id===s.value),p=(d+1)%t.selectedHighlights.length,A=t.selectedHighlights[p];d===p?n.value.currentTime=l.time:t.setCurrentId(A.id)}}$(f,i=>{const l=t.selectedHighlights.findIndex(d=>i>=d.time&&i<=d.time+M);l!==-1?(v.value=t.selectedHighlights[l],g.value=l):v.value=null}),$(s,i=>{r(i)}),ne(()=>{const i=t.selectedHighlights;n.value&&(i.length===0?(f.value=0,n.value.pause(),u.value=!1,t.setCurrentId(0)):(i.length===1||!i.some(l=>l.id===s.value))&&t.setCurrentId(i[0].id))});function b(i){n.value&&(n.value.currentTime=i)}return(i,l)=>{var p;const d=Fe;return _(),k("div",Oe,[l[2]||(l[2]=m("h3",null,"Preview",-1)),H(t).selectedHighlights.length===0?(_(),k(S,{key:0},[l[0]||(l[0]=D(" 尚未選擇片段 ")),a(I,{boilerplate:"",type:"image",class:"ma-4"})],64)):(_(),k(S,{key:1},[m("div",Xe,[m("video",{ref_key:"videoRef",ref:n,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:x},l[1]||(l[1]=[m("source",{type:"video/*"},null,-1),D(" The browser doesn't support HTML5 video. ")]),40,je),v.value?(_(),k("div",We,T(v.value.text),1)):se("",!0)]),a(d,{currentTime:f.value,duration:((p=n.value)==null?void 0:p.duration)||0,highlights:H(t).selectedHighlights,clipDuration:5,onSeek:b},null,8,["currentTime","duration","highlights"]),a(w,{icon:"mdi-chevron-double-left",onClick:c}),a(w,{icon:u.value?"mdi-pause":"mdi-play",onClick:h},null,8,["icon"]),a(w,{icon:"mdi-chevron-double-right",onClick:o})],64))])}}}),Ge=E(qe,[["__scopeId","data-v-1e39d412"]]),Je={class:"py-2"},Ke=["onClick"],Qe=L({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const t=K(),{currentId:s,selectedHighlights:n}=F(t);function f(c){n.value.some(x=>x.id===c.id)?t.removeHighlight(c.id):t.addHighlight(c)}function v(c){return n.value.some(o=>o.id===c.id)}const u=C(null),g=new Map;function h(c,o){o instanceof HTMLElement&&g.set(c,o)}function r(){ie(()=>{const c=g.get(s.value),o=u.value;if(c&&o){const x=c.offsetTop,b=c.offsetHeight,i=o.clientHeight,l=x-i/2+b/2;o.scrollTo({top:l,behavior:"smooth"})}})}return $(s,()=>{s.value!=null&&r()}),(c,o)=>(_(),k("div",{class:"border pa-4 bg-grey-lighten-4 editor-container",ref_key:"containerRef",ref:u},[o[0]||(o[0]=m("h3",null,"Transcript",-1)),(_(!0),k(S,null,N(e.sections,(x,b)=>(_(),k("div",{key:b},[m("h4",Je,T(x.title),1),m("ul",null,[(_(!0),k(S,null,N(x.highlights,(i,l)=>(_(),k("li",{key:l,ref_for:!0,ref:d=>h(i.id,d),onClick:d=>f(i),class:U([{"bg-blue-darken-3":i.id===H(s),"text-grey-lighten-2":v(i)&&i.id===H(s),"text-blue-lighten-1":v(i)&&i.id!==H(s),"border-primary":v(i),"bg-grey-lighten-3":i.id!==H(s)},"border-md rounded-lg ma-2 pa-2"])},[m("strong",null,T(i.time)+"s",1),D(" - "+T(i.text),1)],10,Ke))),128))]),a(le)]))),128))],512))}}),Ye=E(Qe,[["__scopeId","data-v-88567e02"]]);async function Ze(e){const t=await fetch(`/getSections?duration=${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}const et=L({__name:"EditorLoader",async setup(e){let t,s;const n=oe(),f=ze(),{videoUrl:v}=F(f);f.videoDuration==0&&(f.resetVideo(),n.push("/"));const u=C(([t,s]=ae(()=>Ze(f.videoDuration)),t=await t,s(),t));return re(()=>{f.resetVideo()}),(g,h)=>{const r=Ye,c=Ge;return _(),q(G,null,{default:y(()=>[a(J,null,{default:y(()=>[a(R,null,{default:y(()=>[a(r,{sections:u.value},null,8,["sections"])]),_:1}),a(R,null,{default:y(()=>[a(c,{videoUrl:H(v)},null,8,["videoUrl"])]),_:1})]),_:1})]),_:1})}}}),tt=ce("v-alert-title"),nt=["success","info","warning","error"],st=de({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:De,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>nt.includes(e)},...Be(),...$e(),...we(),...Pe(),...Se(),...Ie(),...Ve(),...Te(),...He(),...Ce({variant:"flat"})},"VAlert"),it=ue()({name:"VAlert",props:st(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:s,slots:n}=t;const f=fe(e,"modelValue"),v=j(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:u}=ve(e),{colorClasses:g,colorStyles:h,variantClasses:r}=me(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:c}=ge(e),{dimensionStyles:o}=he(e),{elevationClasses:x}=_e(e),{locationStyles:b}=pe(e),{positionClasses:i}=ye(e),{roundedClasses:l}=ke(e),{textColorClasses:d,textColorStyles:p}=xe(()=>e.borderColor),{t:A}=be(),P=j(()=>({"aria-label":A(e.closeLabel),onClick(z){f.value=!1,s("click:close",z)}}));return()=>{const z=!!(n.prepend||v.value),Q=!!(n.title||e.title),Y=!!(n.close||e.closable);return f.value&&a(e.tag,{class:U(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},u.value,g.value,c.value,x.value,i.value,l.value,r.value,e.class]),style:B([h.value,o.value,b.value,e.style]),role:"alert"},{default:()=>{var O,X;return[Re(!1,"v-alert"),e.border&&m("div",{key:"border",class:U(["v-alert__border",d.value]),style:B(p.value)},null),z&&m("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?a(W,{key:"prepend-defaults",disabled:!v.value,defaults:{VIcon:{density:e.density,icon:v.value,size:e.prominent?44:28}}},n.prepend):a(Le,{key:"prepend-icon",density:e.density,icon:v.value,size:e.prominent?44:28},null)]),m("div",{class:"v-alert__content"},[Q&&a(tt,{key:"title"},{default:()=>{var V;return[((V=n.title)==null?void 0:V.call(n))??e.title]}}),((O=n.text)==null?void 0:O.call(n))??e.text,(X=n.default)==null?void 0:X.call(n)]),n.append&&m("div",{key:"append",class:"v-alert__append"},[n.append()]),Y&&m("div",{key:"close",class:"v-alert__close"},[n.close?a(W,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var V;return[(V=n.close)==null?void 0:V.call(n,{props:P.value})]}}):a(w,Ee({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},P.value),null)])]}})}}}),lt={},ot={class:"border pa-4"},at={class:"border pa-4"};function rt(e,t){const s=et;return _(),q(Ae,null,{default:y(()=>[a(s)]),fallback:y(()=>[a(G,null,{default:y(()=>[a(J,null,{default:y(()=>[a(R,null,{default:y(()=>[m("div",ot,[t[0]||(t[0]=m("h3",null,"Transcript",-1)),a(I,{type:"list-item-three-line"}),a(I,{type:"list-item-three-line"}),a(I,{type:"list-item-three-line"})])]),_:1}),a(R,null,{default:y(()=>[m("div",at,[t[1]||(t[1]=m("h3",null,"Preview",-1)),a(I,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:y(({error:n})=>[a(it,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:y(()=>[D(" 發生錯誤："+T(n.message),1)]),_:2},1024)]),_:1})}const dt=E(lt,[["render",rt]]);export{dt as default};
