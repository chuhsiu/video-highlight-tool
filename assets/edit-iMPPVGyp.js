import{d as R,j as Z,h as k,o as _,g as m,F as S,k as M,n as $,t as T,_ as L,l as ee,r as C,m as te,s as F,w as N,p as ne,q as H,i as B,e as a,f as le,V as w,v as se,x as U,y as ie,u as oe,z as ae,A as re,c as q,b as y,B as ce,C as ue,D as de,E as fe,G as j,H as ve,I as me,J as ge,K as he,L as _e,M as pe,N as ye,O as ke,P as xe,Q as be,R as Ce,S as He,T as Te,U as Ve,W as Ie,X as Se,Y as Pe,Z as we,$ as $e,a0 as Be,a1 as De,a2 as Re,a3 as Le,a4 as W,a5 as Ee,a6 as Ae}from"./index-DwiG0Ysi.js";import{b as I,u as ze,c as G,a as D,V as J}from"./VSkeletonLoader-CmBdRHHa.js";const Me={class:"timeline bar"},Ne={class:"timeline-info"},Ue=R({__name:"VideoTimeline",props:{currentTime:{},duration:{},highlights:{},clipDuration:{}},emits:["seek"],setup(e,{emit:t}){const s=e,n=t,f=Z(()=>s.duration?s.currentTime/s.duration*100:0);function v(c){const r=Math.floor(c/60),o=Math.floor(c%60);return`${String(r).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function u(c){return s.duration?c/s.duration*100:0}function g(c){if(!s.duration)return 0;const r=s.clipDuration/s.duration*100,o=c!==void 0?u(c):0;return Math.min(r,100-o)}function h(c){const o=c.currentTarget.getBoundingClientRect(),b=(c.clientX-o.left)/o.width,l=s.duration*b;n("seek",l)}return(c,r)=>(_(),k("div",{class:"timeline-wrapper",onClick:r[0]||(r[0]=o=>h(o))},[m("div",Me,[(_(!0),k(S,null,M(c.highlights,o=>(_(),k("div",{key:o.id,class:"timeline marker",style:$({left:u(o.time)+"%",width:g(o.time)+"%"})},null,4))),128))]),m("div",{class:"timeline indicator",style:$({left:f.value+"%"})},null,4),m("div",Ne,[m("span",null,T(v(c.currentTime)),1),m("span",null,T(v(c.duration)),1)])]))}}),Fe=L(Ue,[["__scopeId","data-v-3114bbeb"]]),K=ee("player",()=>{const e=C(null);function t(u){e.value=u}const s=te([]);function n(u){s.some(h=>h.id===u.id)||(s.push(u),s.sort((h,c)=>h.time-c.time))}function f(u){const g=s.findIndex(h=>h.id===u);g>=0&&s.splice(g,1)}function v(u){s.splice(0,s.length,...u.sort((g,h)=>g.time-h.time))}return{currentId:e,setCurrentId:t,selectedHighlights:s,setHighlights:v,addHighlight:n,removeHighlight:f}}),Oe={class:"border pa-4"},Xe={style:{position:"relative"}},je=["src"],We={key:0,style:{position:"absolute",left:"0",bottom:"0",translate:"(-50%, 0%)","font-size":"10px","font-weight":"300"}},z=5,qe=R({__name:"VideoPreview",props:{videoUrl:{type:String}},setup(e){const t=K(),{currentId:s}=F(t),n=C(null),f=C(0),v=C(null),u=C(!1),g=C(0);function h(){n.value&&(n.value.paused?(n.value.play(),u.value=!0):(n.value.pause(),u.value=!1))}function c(l){const i=t.selectedHighlights.findIndex(p=>p.id===l);if(i===-1)return;const d=t.selectedHighlights[i];g.value=i,n.value&&(n.value.currentTime=d.time)}function r(){if(t.selectedHighlights.length===0||s.value==null)return;const l=t.selectedHighlights.findIndex(p=>p.id===s.value);if(l===-1)return;const i=l===0?t.selectedHighlights.length-1:l-1,d=t.selectedHighlights[i];t.setCurrentId(d.id)}function o(){if(t.selectedHighlights.length===0||s.value==null)return;const l=t.selectedHighlights.findIndex(p=>p.id===s.value);if(l===-1)return;const i=(l+1)%t.selectedHighlights.length,d=t.selectedHighlights[i];t.setCurrentId(d.id)}function x(){if(!n.value)return;f.value=n.value.currentTime;const l=t.selectedHighlights.find(d=>f.value>=d.time&&f.value<d.time+z);l?(v.value=l,s.value!==l.id&&t.setCurrentId(l.id)):v.value=null;const i=t.selectedHighlights.find(d=>d.id===s.value);if(i&&f.value>=i.time+z){const d=t.selectedHighlights.findIndex(P=>P.id===s.value),p=(d+1)%t.selectedHighlights.length,E=t.selectedHighlights[p];d===p?n.value.currentTime=i.time:t.setCurrentId(E.id)}}N(f,l=>{const i=t.selectedHighlights.findIndex(d=>l>=d.time&&l<=d.time+z);i!==-1?(v.value=t.selectedHighlights[i],g.value=i):v.value=null}),N(s,l=>{c(l)}),ne(()=>{const l=t.selectedHighlights;n.value&&(l.length===0?(f.value=null,n.value.pause(),u.value=!1,t.setCurrentId(null)):(l.length===1||!l.some(i=>i.id===s.value))&&t.setCurrentId(l[0].id))});function b(l){n.value&&(n.value.currentTime=l)}return(l,i)=>{var p;const d=Fe;return _(),k("div",Oe,[i[2]||(i[2]=m("h3",null,"Preview",-1)),H(t).selectedHighlights.length===0?(_(),k(S,{key:0},[i[0]||(i[0]=B(" 尚未選擇片段 ")),a(I,{boilerplate:"",type:"image",class:"ma-4"})],64)):(_(),k(S,{key:1},[m("div",Xe,[m("video",{ref_key:"videoRef",ref:n,width:"100%",src:e.videoUrl,class:"video-player",onTimeupdate:x},i[1]||(i[1]=[m("source",{type:"video/*"},null,-1),B(" The browser doesn't support HTML5 video. ")]),40,je),v.value?(_(),k("div",We,T(v.value.text),1)):le("",!0)]),a(d,{currentTime:f.value,duration:((p=n.value)==null?void 0:p.duration)||0,highlights:H(t).selectedHighlights,clipDuration:5,onSeek:b},null,8,["currentTime","duration","highlights"]),a(w,{icon:"mdi-chevron-double-left",onClick:r}),a(w,{icon:u.value?"mdi-pause":"mdi-play",onClick:h},null,8,["icon"]),a(w,{icon:"mdi-chevron-double-right",onClick:o})],64))])}}}),Ge=L(qe,[["__scopeId","data-v-e52123dc"]]),Je={class:"py-2"},Ke=["onClick"],Qe=R({__name:"HighlightEditor",props:{sections:{type:Array}},setup(e){const t=K(),{currentId:s,selectedHighlights:n}=F(t);function f(r){n.value.some(x=>x.id===r.id)?t.removeHighlight(r.id):t.addHighlight(r)}function v(r){return n.value.some(o=>o.id===r.id)}const u=C(null),g=new Map;function h(r,o){o instanceof HTMLElement&&g.set(r,o)}function c(){se(()=>{const r=g.get(s.value),o=u.value;if(r&&o){const x=r.offsetTop,b=r.offsetHeight,l=o.clientHeight,i=x-l/2+b/2;o.scrollTo({top:i,behavior:"smooth"})}})}return N(s,()=>{s.value!=null&&c()}),(r,o)=>(_(),k("div",{class:"border pa-4 bg-grey-lighten-4 editor-container",ref_key:"containerRef",ref:u},[o[0]||(o[0]=m("h3",null,"Transcript",-1)),(_(!0),k(S,null,M(e.sections,(x,b)=>(_(),k("div",{key:b},[m("h4",Je,T(x.title),1),m("ul",null,[(_(!0),k(S,null,M(x.highlights,(l,i)=>(_(),k("li",{key:i,ref_for:!0,ref:d=>h(l.id,d),onClick:d=>f(l),class:U([{"bg-blue-darken-3":l.id===H(s),"text-grey-lighten-2":v(l)&&l.id===H(s),"text-blue-lighten-1":v(l)&&l.id!==H(s),"border-primary":v(l),"bg-grey-lighten-3":l.id!==H(s)},"border-md rounded-lg ma-2 pa-2"])},[m("strong",null,T(l.time)+"s",1),B(" - "+T(l.text),1)],10,Ke))),128))]),a(ie)]))),128))],512))}}),Ye=L(Qe,[["__scopeId","data-v-88567e02"]]);async function Ze(e){const t=await fetch(`/getSections?duration=${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}const et=R({__name:"EditorLoader",async setup(e){let t,s;const n=oe(),f=ze(),{videoUrl:v}=F(f);f.videoDuration==0&&(f.resetVideo(),n.push("/"));const u=C(([t,s]=ae(()=>Ze(f.videoDuration)),t=await t,s(),t));return re(()=>{f.resetVideo()}),(g,h)=>{const c=Ye,r=Ge;return _(),q(G,null,{default:y(()=>[a(J,null,{default:y(()=>[a(D,null,{default:y(()=>[a(c,{sections:u.value},null,8,["sections"])]),_:1}),a(D,null,{default:y(()=>[a(r,{videoUrl:H(v)},null,8,["videoUrl"])]),_:1})]),_:1})]),_:1})}}}),tt=ce("v-alert-title"),nt=["success","info","warning","error"],lt=de({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:De,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>nt.includes(e)},...Be(),...$e(),...we(),...Pe(),...Se(),...Ie(),...Ve(),...Te(),...He(),...Ce({variant:"flat"})},"VAlert"),st=ue()({name:"VAlert",props:lt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:s,slots:n}=t;const f=fe(e,"modelValue"),v=j(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),{themeClasses:u}=ve(e),{colorClasses:g,colorStyles:h,variantClasses:c}=me(()=>({color:e.color??e.type,variant:e.variant})),{densityClasses:r}=ge(e),{dimensionStyles:o}=he(e),{elevationClasses:x}=_e(e),{locationStyles:b}=pe(e),{positionClasses:l}=ye(e),{roundedClasses:i}=ke(e),{textColorClasses:d,textColorStyles:p}=xe(()=>e.borderColor),{t:E}=be(),P=j(()=>({"aria-label":E(e.closeLabel),onClick(A){f.value=!1,s("click:close",A)}}));return()=>{const A=!!(n.prepend||v.value),Q=!!(n.title||e.title),Y=!!(n.close||e.closable);return f.value&&a(e.tag,{class:U(["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},u.value,g.value,r.value,x.value,l.value,i.value,c.value,e.class]),style:$([h.value,o.value,b.value,e.style]),role:"alert"},{default:()=>{var O,X;return[Re(!1,"v-alert"),e.border&&m("div",{key:"border",class:U(["v-alert__border",d.value]),style:$(p.value)},null),A&&m("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?a(W,{key:"prepend-defaults",disabled:!v.value,defaults:{VIcon:{density:e.density,icon:v.value,size:e.prominent?44:28}}},n.prepend):a(Le,{key:"prepend-icon",density:e.density,icon:v.value,size:e.prominent?44:28},null)]),m("div",{class:"v-alert__content"},[Q&&a(tt,{key:"title"},{default:()=>{var V;return[((V=n.title)==null?void 0:V.call(n))??e.title]}}),((O=n.text)==null?void 0:O.call(n))??e.text,(X=n.default)==null?void 0:X.call(n)]),n.append&&m("div",{key:"append",class:"v-alert__append"},[n.append()]),Y&&m("div",{key:"close",class:"v-alert__close"},[n.close?a(W,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var V;return[(V=n.close)==null?void 0:V.call(n,{props:P.value})]}}):a(w,Ee({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},P.value),null)])]}})}}}),it={},ot={class:"border pa-4"},at={class:"border pa-4"};function rt(e,t){const s=et;return _(),q(Ae,null,{default:y(()=>[a(s)]),fallback:y(()=>[a(G,null,{default:y(()=>[a(J,null,{default:y(()=>[a(D,null,{default:y(()=>[m("div",ot,[t[0]||(t[0]=m("h3",null,"Transcript",-1)),a(I,{type:"list-item-three-line"}),a(I,{type:"list-item-three-line"}),a(I,{type:"list-item-three-line"})])]),_:1}),a(D,null,{default:y(()=>[m("div",at,[t[1]||(t[1]=m("h3",null,"Preview",-1)),a(I,{type:"image",class:"ma-4"})])]),_:1})]),_:1})]),_:1})]),error:y(({error:n})=>[a(st,{type:"error",color:"error",icon:"mdi-alert-circle"},{default:y(()=>[B(" 發生錯誤："+T(n.message),1)]),_:2},1024)]),_:1})}const dt=L(it,[["render",rt]]);export{dt as default};
